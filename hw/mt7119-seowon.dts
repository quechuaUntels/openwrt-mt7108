/dts-v1/;
#include "mt7108.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>

/ {
    model = "Seowon Intech SWC-9000 OpenWrt";
    compatible = "seowon,swc9000", "mediatek,mt7108";

    chosen {
        /* Linea de comando exacta del kernel original */
        bootargs = "console=ttyS1,115200n8 mem=54M@0x0 mem=64M@0x3800000 root=/dev/mtdblock1 rw";
        stdout-path = &uart1;
    };

    memory@0 {
        device_type = "memory";
        reg = <0x00000000 0x03600000>,
              <0x03800000 0x04000000>;
    };

    leds {
        compatible = "gpio-leds";
        status_green: green {
            label = "seowon:green:status";
            gpios = <&pio 10 GPIO_ACTIVE_HIGH>;
            default-state = "on";
        };
        error_red: red {
            label = "seowon:red:error";
            gpios = <&pio 12 GPIO_ACTIVE_HIGH>;
        };
        wlan: wlan {
            label = "seowon:green:wlan";
            gpios = <&pio 0 GPIO_ACTIVE_HIGH>;
        };
    };

    keys {
        compatible = "gpio-keys";
        reset {
            label = "reset";
            gpios = <&pio 2 GPIO_ACTIVE_LOW>;
            linux,code = <KEY_RESTART>;
        };
        wps {
            label = "wps";
            gpios = <&pio 9 GPIO_ACTIVE_LOW>;
            linux,code = <KEY_WPS_BUTTON>;
        };
    };
};

/* Habilitamos los perifericos en el archivo de dispositivo */
&uart1 { status = "okay"; interrupts = <7>; };
&uart0 { status = "okay"; interrupts = <8>; };

&usb {
    status = "okay";
    dr_mode = "host";
    interrupts = <13>;
};

&nand {
    status = "okay";
    /* Usamos la dirección de datos 0x60000000 confirmada por Redboot */
    reg = <0x80020000 0x1000>, /* Control MMIO */
          <0x60000000 0x4000000>; /* Ventana de memoria Flash */

    partitions {
        compatible = "fixed-partitions";
        #address-cells = <1>;
        #size-cells = <1>;

        partition@0 {
            label = "Redboot";
            reg = <0x0 0x40000>;
            read-only;
        };

        partition@40000 {
            label = "firmware"; /* Etiqueta OpenWrt estándar */
            reg = <0x40000 0x1600000>;
        };
        /* El resto de la memoria */
        partition@1640000 {
            label = "user_data";
            reg = <0x1640000 0x29c0000>;
        };
    };
};

/* NODO PARA EL SWITCH ETHERNET EXTERNO IP175C */
switch: ethernet-switch@0 {
    compatible = "icplus,ip175c";
    /* El driver original usa 0x89000000 y 0x80020000 */
    reg = <0x89000000 0x1000>; 
    /* ... (configuración de puertos mii/phy, si es necesaria) ... */
    status = "okay";
};
